<!-- LOADING -->
@if (loading) {
  <div class="loading-box center">
    <p>Loading commits‚Ä¶ ‚è≥</p>
  </div>
}

<!-- COMMITS LIST -->
@if (commits && selectedRepo && !loading) {

  <h3 class="commit-header">Commits for {{ selectedRepo }}</h3>

  <div class="commit-list">

    @for (c of commits; track c.sha) {

      <div class="commit-card card">

        <!-- LEFT CONTENT -->
        <div class="commit-content">

          <div class="msg">{{ c.message }}</div>

          <div class="meta">
            Author: {{ c.author }} <br />
            Date: {{ c.date | date:'medium' }} <br/>
            <a [href]="c.url" target="_blank">View on GitHub</a>
          </div>

          @if (c.reason) {
            <div class="reason">{{ c.reason }}</div>
          }
        </div>

        <!-- RIGHT ACTIONS -->
        <div class="commit-actions">

          <!-- REAL CHECKBOX -->
          <label class="tick-wrapper">
            <input type="checkbox"
                   [checked]="selectedForReport[c.sha]"
                   (change)="toggleCommitSelection(c.sha, $event)" />
            <span class="tick-icon"></span>
          </label>

          <button class="diff-btn" (click)="openDiff(c.url)">
            View Diff
          </button>
        </div>

      </div>

    }

  </div>

  <!-- ANALYZE BUTTON -->
  @if (commits.length > 0) {
    <button class="analyze-btn"
            (click)="analyzeCommits()"
            [disabled]="loadingAI">
      üîç Analyze Commits for SR&ED
    </button>
  }

  @if (loadingAI) {
    <p class="center">Analyzing commits with AI‚Ä¶ please wait ‚è≥</p>
  }
}

<!-- NO COMMITS -->
@if (commits && commits.length === 0 && !loading) {
  <p class="no-data">No commits found in this repository.</p>
}

<!-- SRED TAGGED COMMITS -->
@if (classified && classified.length > 0) {

  <h3 class="commit-header">SR&ED-Tagged Commits</h3>

  @for (c of classified; track c.sha) {

    <div class="commit-card card sred-card">

      <div class="commit-content">
        <div class="msg">
          <input type="checkbox"
                 [checked]="selectedForReport[c.sha]"
                 (change)="toggleCommitSelection(c.sha, $event)" />
          <strong>{{ c.sha.substring(0, 7) }}</strong> ‚Äî {{ c.category }}
        </div>

        <div class="reason">
          {{ c.reason }}
        </div>
      </div>

      <div class="commit-actions">
        <label class="tick-wrapper">
          <input type="checkbox"
                 [checked]="selectedForReport[c.sha]"
                 (change)="toggleCommitSelection(c.sha, $event)" />
          <span class="tick-icon"></span>
        </label>

        <button class="diff-btn" (click)="openDiff(c.url)">View Diff</button>
      </div>

    </div>

  }

  <button class="generate-btn"
          (click)="generateTimeline()"
          [disabled]="generatingTimeline">
    üìÑ Auto-Generate SR&ED Timeline Report
  </button>

  <button
  class="save-btn"
  (click)="saveReport()"
  [disabled]="!reportReady"
>
  Save SR&ED Report
</button>
}

<!-- TIMELINE -->
@if (generatingTimeline) {
  <p class="center">Generating SR&ED timeline‚Ä¶ ‚è≥</p>
}

@if (timeline) {
  <div class="timeline-container">
    <h2>SR&ED Timeline Report (Markdown)</h2>
    <pre>{{ timeline }}</pre>
  </div>
}
